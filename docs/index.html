<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMMLU+ Leaderboard</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <style>
        :root { --primary: #2563eb; --secondary: #10b981; --bg: #f8fafc; }
        body { background-color: var(--bg); font-family: 'Inter', -apple-system, sans-serif; color: #1e293b; }
        
        .hero { background: white; border-bottom: 1px solid #e2e8f0; padding: 60px 0; margin-bottom: 40px; }
        .chart-container { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 30px; min-height: 450px; }
        
        .lb-card { background: white; border-radius: 12px; margin-bottom: 12px; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: 0.2s; }
        .lb-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        
        .row-trigger { display: grid; grid-template-columns: 2fr 1fr 1fr 40px; padding: 18px 25px; cursor: pointer; align-items: center; }
        .lb-header { display: grid; grid-template-columns: 2fr 1fr 1fr 40px; padding: 12px 25px; font-weight: 700; background: #334155; color: white; border-radius: 12px; margin-bottom: 15px; }
        
        .score-main { font-weight: 800; color: var(--primary); font-size: 1.1rem; }
        .subject-tag { font-size: 0.75rem; background: #f1f5f9; padding: 2px 8px; border-radius: 4px; margin: 2px; display: inline-block; }
    </style>
</head>
<body>

<div class="hero">
    <div class="container text-center">
        <h1 class="display-4 fw-bold">üìä TMMLU+ Leaderboard</h1>
        <p class="text-muted">Evaluating Massive Multitask Language Understanding in Traditional Chinese</p>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-6">
            <div class="chart-container">
                <h5 class="text-center fw-bold">Discipline Comparison (Radar)</h5>
                <div id="radar-chart"></div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-container">
                <h5 class="text-center fw-bold">Average by Category (Bar)</h5>
                <div id="bar-chart"></div>
            </div>
        </div>
    </div>

    <h3 class="fw-bold mb-4 mt-4">üèÜ Model Rankings</h3>
    <div class="lb-header">
        <div>Model Name</div>
        <div class="text-center">Overall</div>
        <div class="text-center">TMMLU+ Avg</div>
        <div></div>
    </div>
    
    <div id="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
    </div>
    <div class="accordion" id="leaderboard"></div>
</div>

<script>
// Configuration
const CSV_PATH = 'https://raw.githubusercontent.com/MuhammadSaqlainAslam/tmmlu-leaderboard/main/results/benchmark.csv';

const CATEGORIES = {
    "Science": ["fire_science", "secondary_physics", "advance_chemistry", "organic_chemistry", "physics", "junior_science_exam", "junior_chemistry", "engineering_math", "statistics_and_machine_learning", "tve_mathematics", "tve_natural_sciences"],
    "Business": ["auditing", "financial_analysis", "insurance_studies", "business_management", "marketing_management", "management_accounting", "finance_banking", "taxation", "real_estate", "anti_money_laundering", "trust_practice", "official_document_management"],
    "Health & Med": ["clinical_psychology", "pharmacy", "veterinary_pathology", "dentistry", "pharmacology", "veterinary_pharmacology", "basic_medical_science", "occupational_therapy_for_psychological_disorders", "optometry", "traditional_chinese_medicine_clinical_medicine"],
    "Humanities": ["logic_reasoning", "education", "educational_psychology", "human_behavior", "geography_of_taiwan", "jce_humanities", "chinese_language_and_literature", "junior_chinese_exam", "politic_science", "three_principles_of_people", "national_protection", "general_principles_of_law", "administrative_law", "introduction_to_law", "taiwanese_hokkien", "music", "education_(profession_level)"],
    "Tech & Eng": ["computer_science", "mechanical", "nautical_science", "technical", "agriculture", "culinary_skills", "tve_design"]
};

// Data Processing
Papa.parse(CSV_PATH, {
    download: true,
    header: true,
    dynamicTyping: true,
    complete: function(results) {
        processData(results.data);
    }
});

function processData(data) {
    const models = Object.keys(data[0]).filter(k => k !== 'task_name' && k !== 'metric');
    let processed = models.map(name => {
        let scores = { name, categoryScores: {}, overallSum: 0, count: 0 };
        
        data.forEach(row => {
            const val = row[name];
            if (val === null || val === undefined || isNaN(val)) return;
            if (row.metric !== 'accuracy' && row.metric !== 'prefix_exact_match') return;

            scores.overallSum += val;
            scores.count++;

            // Check categories
            for (let cat in CATEGORIES) {
                if (CATEGORIES[cat].some(sub => row.task_name.includes(sub))) {
                    if (!scores.categoryScores[cat]) scores.categoryScores[cat] = [];
                    scores.categoryScores[cat].push(val);
                }
            }
        });

        // Compute Averages
        for (let cat in scores.categoryScores) {
            let arr = scores.categoryScores[cat];
            scores.categoryScores[cat] = arr.reduce((a,b)=>a+b,0) / arr.length;
        }
        scores.overall = scores.overallSum / scores.count;
        scores.tmmlu_avg = Object.values(scores.categoryScores).reduce((a,b)=>a+b,0) / Object.keys(scores.categoryScores).length;
        
        return scores;
    });

    processed.sort((a,b) => b.overall - a.overall);
    renderUI(processed);
}

function renderUI(data) {
    document.getElementById('loading').style.display = 'none';
    const container = document.getElementById('leaderboard');
    
    data.forEach((m, i) => {
        const html = `
            <div class="lb-card">
                <div class="row-trigger" data-bs-toggle="collapse" data-bs-target="#details-${i}">
                    <div class="fw-bold">${m.name}</div>
                    <div class="text-center score-main">${(m.overall * 100).toFixed(1)}%</div>
                    <div class="text-center">${(m.tmmlu_avg * 100).toFixed(1)}%</div>
                    <div class="text-end text-muted">‚ñº</div>
                </div>
                <div id="details-${i}" class="collapse p-4 border-top" data-bs-parent="#leaderboard">
                    <div class="row">
                        ${Object.entries(m.categoryScores).map(([cat, score]) => `
                            <div class="col-6 col-md-4 mb-3">
                                <small class="text-muted d-block">${cat}</small>
                                <span class="fw-bold">${(score*100).toFixed(1)}%</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>`;
        container.insertAdjacentHTML('beforeend', html);
    });

    drawCharts(data);
}

function drawCharts(data) {
    const cats = Object.keys(CATEGORIES);
    
    // Radar
    const radarTraces = data.map(m => ({
        type: 'scatterpolar',
        r: cats.map(c => m.categoryScores[c] || 0),
        theta: cats,
        fill: 'toself',
        name: m.name
    }));
    Plotly.newPlot('radar-chart', radarTraces, { 
        polar: { radialaxis: { visible: true, range: [0, 1] } },
        margin: { l: 40, r: 40, t: 20, b: 20 },
        legend: { orientation: 'h' }
    });

    // Bar
    const barTraces = data.map(m => ({
        x: cats,
        y: cats.map(c => m.categoryScores[c] || 0),
        name: m.name,
        type: 'bar'
    }));
    Plotly.newPlot('bar-chart', barTraces, { 
        barmode: 'group',
        yaxis: { range: [0, 1], tickformat: ',.0%' },
        legend: { orientation: 'h' }
    });
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
