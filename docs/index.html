<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>TMMLU+ Leaderboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body { padding:40px; background:#f8f9fa; }
.card { border-radius:12px; margin-bottom:12px; }
.card-header { cursor:pointer; background:#0d6efd; color:white; }
.card-header:hover { background:#0b5ed7; }
</style>
</head>

<body>

<h2 class="text-center mb-4">üìä TMMLU+ Leaderboard</h2>

<div id="table"></div>
<hr>

<h4 class="text-center">üß≠ TMMLU+ Category Radar (Average)</h4>
<div id="radar"></div>

<hr>

<h4 class="text-center">üìö TMMLU+ Detailed Breakdown</h4>
<div id="accordion"></div>

<script>
// === Dynamically compute base path for JSON ===
const basePath = window.location.pathname.replace(/\/[^\/]*$/, '/');
const jsonURL = basePath + "leaderboard.json";

fetch(jsonURL)
.then(res => {
  if (!res.ok) throw new Error("JSON load failed: " + res.status);
  return res.json();
})
.then(data => {

  // ------- Table -------
  let html = `<table class="table table-bordered table-striped">
  <thead class="table-dark"><tr><th>Rank</th><th>Model</th><th>Overall</th><th>TMMLU+</th></tr></thead><tbody>`;
  
  data.leaderboard.forEach((m,i) => {
    html += `<tr><td>${i+1}</td><td>${m.model}</td>
             <td>${m.overall}</td><td>${m.tmmlu_overall}</td></tr>`;
  });
  html += "</tbody></table>";
  document.getElementById("table").innerHTML = html;

  // ------- Radar -------
  const colors = ["#1f77b4","#ff7f0e","#2ca02c","#d62728"];
  const radarTraces = [];

  data.leaderboard.forEach((m,i) => {
    const tmmlu = data.details[m.model].tmmlu;
    const cats = Object.keys(tmmlu);
    const avgScores = [];

    cats.forEach(cat => {
      let sum = 0, count = 0;
      Object.values(tmmlu[cat]).forEach(sub => {
        Object.values(sub).forEach(score => {
          sum += score;
          count++;
        });
      });
      avgScores.push(count ? sum/count : 0);
    });

    radarTraces.push({
      type: "scatterpolar",
      r: avgScores,
      theta: cats,
      fill: "toself",
      name: m.model,
      line: { color: colors[i % colors.length] }
    });
  });

  Plotly.newPlot("radar", radarTraces, {
    polar: { radialaxis: { range: [0,1] } },
    legend: { orientation: "h" },
    height: 500
  });

  // ------- Nested Accordion -------
  let accHTML = "";
  data.leaderboard.forEach((m,mi) => {
    accHTML += `
    <div class="card">
      <div class="card-header" data-bs-toggle="collapse" data-bs-target="#model${mi}">
        ${m.model}
      </div>
      <div id="model${mi}" class="collapse">
        <div class="card-body">`;

    const tmmlu = data.details[m.model].tmmlu;
    let ci = 0;

    Object.entries(tmmlu).forEach(([cat, subs]) => {
      accHTML += `
      <div class="card mb-2">
        <div class="card-header bg-secondary text-white"
             data-bs-toggle="collapse"
             data-bs-target="#cat${mi}_${ci}">
          ${cat}
        </div>
        <div id="cat${mi}_${ci}" class="collapse">
          <div class="card-body">`;

      Object.entries(subs).forEach(([sub, tasks]) => {
        accHTML += `<h6>${sub}</h6><ul>`;
        Object.entries(tasks).forEach(([task, score]) => {
          accHTML += `<li>${task}: <b>${score.toFixed(3)}</b></li>`;
        });
        accHTML += "</ul>";
      });

      accHTML += `</div></div></div>`;
      ci++;
    });

    accHTML += `</div></div></div>`;
  });

  document.getElementById("accordion").innerHTML = accHTML;

})
.catch(err => {
  console.error(err);
  document.getElementById("table").innerText = "‚ö†Ô∏è Error loading leaderboard data.";
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
