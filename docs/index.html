<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMMLU+ Leaderboard</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { background-color: var(--bg); font-family: 'Inter', system-ui, -apple-system, sans-serif; color: #1e293b; padding-bottom: 80px; }
        
        .hero { background: white; border-bottom: 1px solid #e2e8f0; padding: 60px 0; margin-bottom: 30px; }
        .chart-container { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; min-height: 480px; }
        
        /* Search Bar */
        .search-wrapper { max-width: 600px; margin: -30px auto 40px auto; position: relative; z-index: 10; }
        .form-control-lg { border-radius: 12px; border: 1px solid #e2e8f0; padding-left: 45px; font-size: 1rem; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #94a3b8; }

        /* Table Styling */
        .lb-header { display: grid; grid-template-columns: 2fr 1fr 1fr 40px; padding: 15px 25px; font-weight: 700; background: #1e293b; color: white; border-radius: 12px; margin-bottom: 12px; }
        .model-card { background: white; border-radius: 12px; margin-bottom: 10px; border: 1px solid #e2e8f0; overflow: hidden; transition: 0.2s; }
        .model-card:hover { border-color: var(--primary); }
        .model-trigger { display: grid; grid-template-columns: 2fr 1fr 1fr 40px; padding: 18px 25px; cursor: pointer; align-items: center; }
        
        .section-title { font-weight: 800; font-size: 0.8rem; color: #64748b; margin-top: 25px; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px; }
        .category-item { border: 1px solid #f1f5f9; border-radius: 8px; margin-bottom: 6px; }
        .category-trigger { padding: 12px 18px; cursor: pointer; display: flex; justify-content: space-between; background: #fafafa; font-weight: 600; font-size: 0.9rem; }
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; padding: 15px; background: white; }
        .subject-stat { border-left: 3px solid #e2e8f0; padding-left: 10px; }
        .subject-name { font-size: 0.75rem; color: #64748b; display: block; text-transform: capitalize; }
        .subject-val { font-weight: 700; font-size: 0.9rem; color: #334155; }
        
        .chart-caption { font-size: 0.85rem; color: #64748b; margin-top: 15px; line-height: 1.5; border-top: 1px dashed #e2e8f0; padding-top: 10px; }
    </style>
</head>
<body>

<div class="hero text-center">
    <div class="container">
        <h1 class="fw-bold text-dark">TMMLU+ Leaderboard</h1>
        <p class="lead text-secondary">A Comprehensive Traditional Chinese Benchmark for Large Language Models</p>
    </div>
</div>

<div class="container">
    <div class="search-wrapper shadow-sm">
        <span class="search-icon">üîç</span>
        <input type="text" id="modelSearch" class="form-control form-control-lg" placeholder="Search models by name (e.g., FoxBrain, GPT-4)...">
    </div>

    <div class="row">
        <div class="col-lg-6">
            <div class="chart-container shadow-sm">
                <div id="radar-chart"></div>
                <p class="chart-caption">
                    <strong>Figure 1: Discipline Radar Map.</strong> This visualization displays the relative strengths of the Top 5 models across five major academic disciplines. A larger area indicates a more balanced and versatile model.
                </p>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-container shadow-sm">
                <div id="bar-chart"></div>
                <p class="chart-caption">
                    <strong>Figure 2: Category Accuracy Comparison.</strong> This chart compares the mean performance of the Top 5 models across specialized groups. It provides insights into which models lead in specific professional fields.
                </p>
            </div>
        </div>
    </div>

    <div class="lb-header mt-4 shadow-sm">
        <div>Model Name</div>
        <div class="text-center">Overall Acc</div>
        <div class="text-center">TMMLU+ Avg</div>
        <div></div>
    </div>
    
    <div id="leaderboard-container"></div>
</div>

<script>
const CSV_PATH = 'https://raw.githubusercontent.com/MuhammadSaqlainAslam/tmmlu-leaderboard/main/results/benchmark.csv';

const DISCIPLINE_MAP = {
    "Science": ["fire_science", "secondary_physics", "advance_chemistry", "organic_chemistry", "physics", "junior_science_exam", "junior_chemistry", "engineering_math", "statistics_and_machine_learning", "tve_mathematics", "tve_natural_sciences"],
    "Business": ["auditing", "financial_analysis", "insurance_studies", "business_management", "marketing_management", "management_accounting", "finance_banking", "taxation", "real_estate", "anti_money_laundering", "trust_practice", "official_document_management"],
    "Health & Med": ["clinical_psychology", "pharmacy", "veterinary_pathology", "dentistry", "pharmacology", "veterinary_pharmacology", "basic_medical_science", "occupational_therapy_for_psychological_disorders", "optometry", "traditional_chinese_medicine_clinical_medicine"],
    "Humanities": ["logic_reasoning", "education", "educational_psychology", "human_behavior", "geography_of_taiwan", "jce_humanities", "chinese_language_and_literature", "junior_chinese_exam", "politic_science", "three_principles_of_people", "national_protection", "general_principles_of_law", "administrative_law", "introduction_to_law", "taiwanese_hokkien", "music", "education_(profession_level)"],
    "Tech & Eng": ["computer_science", "mechanical", "nautical_science", "technical", "agriculture", "culinary_skills", "tve_design"]
};

const GENERAL_TASKS = ["drcd", "penguin_table", "tw-rag", "gsm8k", "gpqa", "aiec", "aitest"];

let fullModelData = [];

Papa.parse(CSV_PATH, {
    download: true, header: true, dynamicTyping: true,
    complete: function(res) { 
        fullModelData = process(res.data);
        render(fullModelData);
        draw(fullModelData);
    }
});

function process(data) {
    const models = Object.keys(data[0]).filter(k => k !== 'task_name' && k !== 'metric');
    return models.map(mName => {
        let mData = { name: mName, disciplines: {}, general: {}, allScores: [] };
        data.forEach(row => {
            const score = row[mName];
            if (score === null || isNaN(score) || !row.task_name) return;
            const taskLower = row.task_name.toLowerCase();
            const metricLower = row.metric.toLowerCase();

            if (metricLower.includes('accuracy') || metricLower.includes('match')) {
                mData.allScores.push(score);
                let isDisc = false;
                for (let disc in DISCIPLINE_MAP) {
                    if (DISCIPLINE_MAP[disc].some(sub => taskLower.includes(sub.toLowerCase()))) {
                        if (!mData.disciplines[disc]) mData.disciplines[disc] = [];
                        mData.disciplines[disc].push({ 
                            subject: row.task_name.split('-').pop().replace(/_/g, ' '), 
                            score: score 
                        });
                        isDisc = true;
                    }
                }
                if (!isDisc) {
                    GENERAL_TASKS.forEach(gt => {
                        if (taskLower.includes(gt)) mData.general[gt.toUpperCase()] = score;
                    });
                }
            }
        });
        mData.overall = mData.allScores.length ? (mData.allScores.reduce((a,b)=>a+b,0)/mData.allScores.length) : 0;
        let dAvgs = Object.values(mData.disciplines).map(arr => arr.reduce((a,b)=>a+b.score,0)/arr.length);
        mData.tmmlu_avg = dAvgs.length ? (dAvgs.reduce((a,b)=>a+b,0)/dAvgs.length) : 0;
        return mData;
    }).sort((a,b) => b.overall - a.overall);
}

function render(data) {
    const container = document.getElementById('leaderboard-container');
    container.innerHTML = "";
    if (data.length === 0) {
        container.innerHTML = `<div class="text-center py-5 text-muted">No models found matching your search.</div>`;
        return;
    }
    data.forEach((m, mIdx) => {
        let discHTML = '';
        for (let disc in m.disciplines) {
            const avg = m.disciplines[disc].reduce((a,b)=>a+b.score,0) / m.disciplines[disc].length;
            const subId = `details-${mIdx}-${disc.replace(/[^a-zA-Z]/g, '')}`;
            discHTML += `<div class="category-item">
                <div class="category-trigger" data-bs-toggle="collapse" data-bs-target="#${subId}">
                    <span>${disc} <small class="text-muted ms-2">(${(avg*100).toFixed(1)}%)</small></span>
                    <small>Subjects ‚ñæ</small>
                </div>
                <div id="${subId}" class="collapse"><div class="subject-grid">
                    ${m.disciplines[disc].map(s => `<div class="subject-stat">
                        <span class="subject-name">${s.subject}</span>
                        <span class="subject-val">${(s.score*100).toFixed(1)}%</span>
                    </div>`).join('')}
                </div></div></div>`;
        }

        let genHTML = '<div class="subject-grid">';
        Object.entries(m.general).forEach(([n, s]) => {
            genHTML += `<div class="subject-stat"><span class="subject-name">${n}</span><span class="subject-val">${(s*100).toFixed(1)}%</span></div>`;
        });
        genHTML += '</div>';

        container.innerHTML += `<div class="model-card shadow-sm">
            <div class="model-trigger" data-bs-toggle="collapse" data-bs-target="#m-exp-${mIdx}">
                <div class="fw-bold text-dark">${m.name}</div>
                <div class="text-center text-primary fw-bold">${(m.overall*100).toFixed(1)}%</div>
                <div class="text-center fw-bold text-secondary">${(m.tmmlu_avg*100).toFixed(1)}%</div>
                <div class="text-end text-muted">‚ñæ</div>
            </div>
            <div id="m-exp-${mIdx}" class="collapse p-4 border-top bg-light">
                <div class="section-title">General Benchmarks</div>
                ${Object.keys(m.general).length ? genHTML : '<p class="text-muted small px-2">No general data found.</p>'}
                <div class="section-title">TMMLU+ Disciplines</div>
                ${discHTML || '<p class="text-muted small px-2">No discipline data found.</p>'}
            </div></div>`;
    });
}

function draw(data) {
    const cats = Object.keys(DISCIPLINE_MAP);
    const top5 = data.slice(0, 5);
    const radarTraces = top5.map(m => ({
        type: 'scatterpolar', r: cats.map(c => {
            const d = m.disciplines[c];
            return d ? (d.reduce((a,b)=>a+b.score,0)/d.length) : 0;
        }), theta: cats, fill: 'toself', name: m.name
    }));
    Plotly.newPlot('radar-chart', radarTraces, { 
        title: { text: 'Top 5 Models: Discipline Radar', font: { weight: 700 } },
        polar: { radialaxis: { range: [0, 1], tickformat: ',.0%' } }, 
        margin: { t: 80, b: 50, l: 50, r: 50 }, 
        legend: { orientation: 'h', y: -0.1 } 
    });

    const barTraces = top5.map(m => ({
        x: cats, y: cats.map(c => {
            const d = m.disciplines[c];
            return d ? (d.reduce((a,b)=>a+b.score,0)/d.length) : 0;
        }), type: 'bar', name: m.name
    }));
    Plotly.newPlot('bar-chart', barTraces, { 
        title: { text: 'Top 5 Models: Category Performance', font: { weight: 700 } },
        barmode: 'group', 
        yaxis: { range: [0, 1], tickformat: ',.0%' }, 
        legend: { orientation: 'h', y: -0.3 } 
    });
}

document.getElementById('modelSearch').addEventListener('input', function(e) {
    const term = e.target.value.toLowerCase();
    const filtered = fullModelData.filter(m => m.name.toLowerCase().includes(term));
    render(filtered);
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
