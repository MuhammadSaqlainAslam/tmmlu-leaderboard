<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMMLU+ Leaderboard</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { background-color: var(--bg); font-family: 'Inter', system-ui, -apple-system, sans-serif; color: #1e293b; padding-bottom: 80px; }
        
        .hero { background: white; border-bottom: 1px solid #e2e8f0; padding: 60px 0; margin-bottom: 30px; }
        .chart-container { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; min-height: 480px; }
        
        /* View Toggler */
        .view-toggler { max-width: 400px; margin: 0 auto 30px auto; display: flex; background: #e2e8f0; padding: 4px; border-radius: 12px; }
        .view-btn { flex: 1; border: none; padding: 10px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; background: none; color: #64748b; }
        .view-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

        /* Comparison Section */
        #comparison-view { display: none; }
        .filter-panel { background: white; border-radius: 16px; padding: 25px; border: 1px solid #e2e8f0; margin-bottom: 30px; position: sticky; top: 20px; }
        .comp-table { background: white; border-radius: 16px; overflow: hidden; border: 1px solid #e2e8f0; }
        .comp-table th { background: #1e293b; color: white; border: none; }
        .comp-table td { font-size: 0.9rem; vertical-align: middle; }
        .score-cell { font-weight: 700; text-align: center; }
        .winner { background-color: #f0fdf4; color: #166534; }

        /* Existing Styles */
        .search-wrapper { max-width: 600px; margin: -30px auto 40px auto; position: relative; z-index: 10; }
        .form-control-lg { border-radius: 12px; border: 1px solid #e2e8f0; padding-left: 45px; font-size: 1rem; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #94a3b8; }
        .lb-header { display: grid; grid-template-columns: 2fr 1fr 1fr 40px; padding: 15px 25px; font-weight: 700; background: #1e293b; color: white; border-radius: 12px; margin-bottom: 12px; }
        .model-card { background: white; border-radius: 12px; margin-bottom: 10px; border: 1px solid #e2e8f0; overflow: hidden; transition: 0.2s; }
        .model-trigger { display: grid; grid-template-columns: 2fr 1fr 1fr 40px; padding: 18px 25px; cursor: pointer; align-items: center; }
        .section-title { font-weight: 800; font-size: 0.8rem; color: #64748b; margin-top: 25px; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px; }
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; padding: 15px; background: white; }
        .subject-stat { border-left: 3px solid #e2e8f0; padding-left: 10px; }
        .subject-name { font-size: 0.75rem; color: #64748b; display: block; text-transform: capitalize; }
        .subject-val { font-weight: 700; font-size: 0.9rem; color: #334155; }
    </style>
</head>
<body>

<div class="hero text-center">
    <div class="container">
        <h1 class="fw-bold text-dark">TMMLU+ Leaderboard</h1>
        <p class="lead text-secondary">Advanced Benchmarking for Traditional Chinese Large Language Models</p>
    </div>
</div>

<div class="container">
    <div class="view-toggler shadow-sm">
        <button class="view-btn active" id="btn-leaderboard" onclick="switchView('leaderboard')">Leaderboard</button>
        <button class="view-btn" id="btn-comparison" onclick="switchView('comparison')">Model Comparison</button>
    </div>

    <div id="leaderboard-view">
        <div class="search-wrapper shadow-sm">
            <span class="search-icon">üîç</span>
            <input type="text" id="modelSearch" class="form-control form-control-lg" placeholder="Search models (e.g., FoxBrain, TAIDE)...">
        </div>

        <div class="row">
            <div class="col-lg-6"><div class="chart-container shadow-sm"><div id="radar-chart"></div></div></div>
            <div class="col-lg-6"><div class="chart-container shadow-sm"><div id="bar-chart"></div></div></div>
        </div>

        <div class="lb-header mt-4 shadow-sm">
            <div>Model Name</div>
            <div class="text-center">Overall Acc</div>
            <div class="text-center">TMMLU+ Avg</div>
            <div></div>
        </div>
        <div id="leaderboard-container"></div>
    </div>

    <div id="comparison-view">
        <div class="row">
            <div class="col-lg-3">
                <div class="filter-panel shadow-sm">
                    <h6 class="fw-bold mb-3">1. Select Models</h6>
                    <div id="model-select-list" class="mb-4"></div>
                    
                    <h6 class="fw-bold mb-3">2. Select Category</h6>
                    <div id="category-select-list"></div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="table-responsive comp-table shadow-sm">
                    <table class="table table-hover mb-0" id="comparison-table">
                        <thead><tr id="comp-header"><th>Task Name</th></tr></thead>
                        <tbody id="comp-body"></tbody>
                    </table>
                </div>
                <div id="no-comp-msg" class="text-center py-5 text-muted">Select at least two models and one category to start comparison.</div>
            </div>
        </div>
    </div>
</div>

<script>
const CSV_PATH = 'https://raw.githubusercontent.com/MuhammadSaqlainAslam/tmmlu-leaderboard/main/results/benchmark.csv';

const DISCIPLINE_MAP = {
    "Science": ["fire_science", "secondary_physics", "advance_chemistry", "organic_chemistry", "physics", "junior_science_exam", "junior_chemistry", "engineering_math", "statistics_and_machine_learning", "tve_mathematics", "tve_natural_sciences"],
    "Business": ["auditing", "financial_analysis", "insurance_studies", "business_management", "marketing_management", "management_accounting", "finance_banking", "taxation", "real_estate", "anti_money_laundering", "trust_practice", "official_document_management"],
    "Health & Med": ["clinical_psychology", "pharmacy", "veterinary_pathology", "dentistry", "pharmacology", "veterinary_pharmacology", "basic_medical_science", "occupational_therapy_for_psychological_disorders", "optometry", "traditional_chinese_medicine_clinical_medicine"],
    "Humanities": ["logic_reasoning", "education", "educational_psychology", "human_behavior", "geography_of_taiwan", "jce_humanities", "chinese_language_and_literature", "junior_chinese_exam", "politic_science", "three_principles_of_people", "national_protection", "general_principles_of_law", "administrative_law", "introduction_to_law", "taiwanese_hokkien", "music", "education_(profession_level)"],
    "Tech & Eng": ["computer_science", "mechanical", "nautical_science", "technical", "agriculture", "culinary_skills", "tve_design"]
};

const GENERAL_TASKS = ["ai2d", "aiec", "aime2025", "apex2025", "aitest", "drcd", "tw-rag", "gsm8k", "gpqa", "bigbenchhard", "chartqa", "fgc", "hle", "mmmu", "penguin_table"];

let rawData = [];
let globalData = [];

Papa.parse(CSV_PATH, {
    download: true, header: true, dynamicTyping: true,
    complete: function(res) { 
        rawData = res.data;
        globalData = process(res.data);
        renderLeaderboard(globalData);
        drawCharts(globalData);
        initComparison();
    }
});

function process(data) {
    const models = Object.keys(data[0]).filter(k => k !== 'task_name' && k !== 'metric');
    return models.map(mName => {
        let mData = { name: mName, disciplines: {}, general: {}, allScores: [] };
        data.forEach(row => {
            const score = row[mName];
            if (score === null || isNaN(score) || score === 0 || !row.task_name) return;
            const taskLower = row.task_name.toLowerCase();
            const metricLower = row.metric.toLowerCase();
            if (metricLower.includes('accuracy') || metricLower.includes('match') || metricLower === 'total_score') {
                mData.allScores.push(score);
                let isDisc = false;
                for (let disc in DISCIPLINE_MAP) {
                    if (DISCIPLINE_MAP[disc].some(sub => taskLower.includes(sub.toLowerCase()))) {
                        if (!mData.disciplines[disc]) mData.disciplines[disc] = [];
                        mData.disciplines[disc].push({ subject: row.task_name.split(/[-/]/).pop().replace(/_/g, ' '), score: score });
                        isDisc = true;
                    }
                }
                if (!isDisc) {
                    GENERAL_TASKS.forEach(gt => {
                        if (taskLower === gt || taskLower.includes(gt)) {
                            if (!mData.general[gt.toUpperCase()] || metricLower === 'total_score') mData.general[gt.toUpperCase()] = score;
                        }
                    });
                }
            }
        });
        mData.overall = mData.allScores.length ? (mData.allScores.reduce((a,b)=>a+b,0)/mData.allScores.length) : 0;
        let dAvgs = Object.values(mData.disciplines).map(arr => arr.reduce((a,b)=>a+b.score,0)/arr.length);
        mData.tmmlu_avg = dAvgs.length ? (dAvgs.reduce((a,b)=>a+b,0)/dAvgs.length) : 0;
        return mData;
    }).sort((a,b) => b.overall - a.overall);
}

function renderLeaderboard(data) {
    const container = document.getElementById('leaderboard-container');
    container.innerHTML = "";
    data.forEach((m, mIdx) => {
        let discHTML = '';
        for (let disc in m.disciplines) {
            const avg = m.disciplines[disc].reduce((a,b)=>a+b.score,0) / m.disciplines[disc].length;
            const subId = `details-${mIdx}-${disc.replace(/[^a-zA-Z]/g, '')}`;
            discHTML += `<div class="category-item"><div class="category-trigger" data-bs-toggle="collapse" data-bs-target="#${subId}">
                <span>${disc} <small class="text-muted ms-2">(${(avg*100).toFixed(1)}%)</small></span><small>‚ñæ</small></div>
                <div id="${subId}" class="collapse"><div class="subject-grid">
                ${m.disciplines[disc].map(s => `<div class="subject-stat"><span class="subject-name">${s.subject}</span><span class="subject-val">${(s.score*100).toFixed(1)}%</span></div>`).join('')}
                </div></div></div>`;
        }
        let genHTML = '<div class="subject-grid">' + Object.entries(m.general).map(([n, s]) => `<div class="subject-stat"><span class="subject-name">${n}</span><span class="subject-val">${(s*100).toFixed(1)}%</span></div>`).join('') + '</div>';

        container.innerHTML += `<div class="model-card shadow-sm"><div class="model-trigger" data-bs-toggle="collapse" data-bs-target="#m-exp-${mIdx}">
            <div class="fw-bold">${m.name}</div><div class="text-center text-primary fw-bold">${(m.overall*100).toFixed(1)}%</div>
            <div class="text-center fw-bold text-secondary">${(m.tmmlu_avg*100).toFixed(1)}%</div><div class="text-end text-muted">‚ñæ</div></div>
            <div id="m-exp-${mIdx}" class="collapse p-4 border-top bg-light">
            <div class="section-title">General Benchmarks</div>${Object.keys(m.general).length ? genHTML : '<p class="text-muted small">None</p>'}
            <div class="section-title">TMMLU+ Disciplines</div>${discHTML || '<p class="text-muted small">None</p>'}</div></div>`;
    });
}

function switchView(view) {
    document.getElementById('leaderboard-view').style.display = view === 'leaderboard' ? 'block' : 'none';
    document.getElementById('comparison-view').style.display = view === 'comparison' ? 'block' : 'none';
    document.getElementById('btn-leaderboard').classList.toggle('active', view === 'leaderboard');
    document.getElementById('btn-comparison').classList.toggle('active', view === 'comparison');
}

function initComparison() {
    const modelList = document.getElementById('model-select-list');
    globalData.forEach(m => {
        modelList.innerHTML += `<div class="form-check"><input class="form-check-input model-chk" type="checkbox" value="${m.name}" id="chk-${m.name}" onchange="updateComparisonTable()">
            <label class="form-check-label small" for="chk-${m.name}">${m.name}</label></div>`;
    });

    const catList = document.getElementById('category-select-list');
    [...Object.keys(DISCIPLINE_MAP), "General Benchmarks"].forEach(cat => {
        catList.innerHTML += `<div class="form-check"><input class="form-check-input cat-chk" type="radio" name="cat" value="${cat}" id="cat-${cat}" onchange="updateComparisonTable()">
            <label class="form-check-label small" for="cat-${cat}">${cat}</label></div>`;
    });
}

function updateComparisonTable() {
    const selectedModels = Array.from(document.querySelectorAll('.model-chk:checked')).map(c => c.value);
    const selectedCat = document.querySelector('.cat-chk:checked')?.value;

    if (selectedModels.length < 1 || !selectedCat) {
        document.getElementById('comparison-table').style.display = 'none';
        document.getElementById('no-comp-msg').style.display = 'block';
        return;
    }

    document.getElementById('comparison-table').style.display = 'table';
    document.getElementById('no-comp-msg').style.display = 'none';

    // Header
    const header = document.getElementById('comp-header');
    header.innerHTML = '<th>Task / Subject</th>';
    selectedModels.forEach(m => header.innerHTML += `<th class="text-center">${m}</th>`);

    // Body
    const body = document.getElementById('comp-body');
    body.innerHTML = '';

    let tasks = [];
    if (selectedCat === "General Benchmarks") {
        tasks = GENERAL_TASKS.map(t => t.toUpperCase());
    } else {
        tasks = DISCIPLINE_MAP[selectedCat].map(t => t.replace(/_/g, ' '));
    }

    tasks.forEach(task => {
        let rowHtml = `<tr><td class="fw-semibold text-capitalize">${task}</td>`;
        let scores = selectedModels.map(mName => {
            const m = globalData.find(d => d.name === mName);
            let score = 0;
            if (selectedCat === "General Benchmarks") {
                score = m.general[task] || 0;
            } else {
                const sub = m.disciplines[selectedCat]?.find(s => s.subject.toLowerCase() === task.toLowerCase() || task.toLowerCase().includes(s.subject.toLowerCase()));
                score = sub ? sub.score : 0;
            }
            return score;
        });

        const maxScore = Math.max(...scores);
        scores.forEach(s => {
            const isWinner = s > 0 && s === maxScore && selectedModels.length > 1;
            rowHtml += `<td class="score-cell ${isWinner ? 'winner' : ''}">${s > 0 ? (s * 100).toFixed(1) + '%' : '-'}</td>`;
        });
        rowHtml += '</tr>';
        if (scores.some(s => s > 0)) body.innerHTML += rowHtml;
    });
}

function drawCharts(data) {
    const cats = Object.keys(DISCIPLINE_MAP);
    const topCount = Math.min(data.length, 5);
    const displayData = data.slice(0, topCount);
    
    const radarTraces = displayData.map(m => ({
        type: 'scatterpolar', r: cats.map(c => m.disciplines[c] ? (m.disciplines[c].reduce((a,b)=>a+b.score,0)/m.disciplines[c].length) : 0),
        theta: cats, fill: 'toself', name: m.name
    }));
    Plotly.newPlot('radar-chart', radarTraces, { title: 'Discipline Radar Map', polar: { radialaxis: { range: [0, 1], tickformat: ',.0%' } }, margin: { t: 60, b: 40, l: 40, r: 40 }, legend: { orientation: 'h', y: -0.2 } });

    const barTraces = displayData.map(m => ({
        x: cats, y: cats.map(c => m.disciplines[c] ? (m.disciplines[c].reduce((a,b)=>a+b.score,0)/m.disciplines[c].length) : 0),
        type: 'bar', name: m.name
    }));
    Plotly.newPlot('bar-chart', barTraces, { title: 'Category Performance', barmode: 'group', yaxis: { range: [0, 1], tickformat: ',.0%' }, legend: { orientation: 'h', y: -0.4 } });
}

document.getElementById('modelSearch').addEventListener('input', function(e) {
    const term = e.target.value.toLowerCase();
    renderLeaderboard(globalData.filter(m => m.name.toLowerCase().includes(term)));
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
